"use strict";var _get=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(e===void 0){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},_createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function easeOutBack(a,b){return void 0==b&&(b=1.70158),--a*a*((b+1)*a+b)+1}var GameObject=function(){function a(b){_classCallCheck(this,a),this.game=b,b.add(this)}return _createClass(a,[{key:"destroy",value:function destroy(){this.game.remove(this)}},{key:"contains",value:function contains(b){if(null===this.BBox)return!1;var c=b.x,d=b.y;return c>=this.BBox.x&&d>=this.BBox.y&&c<=this.BBox.x+this.BBox.width&&d<=this.BBox.y+this.BBox.height}},{key:"collides",value:function collides(b){return b.contains({x:this.BBox.x+this.BBox.width/2,y:this.BBox.y})||b.contains({x:this.BBox.x+this.BBox.width/2,y:this.BBox.y+this.BBox.height})?"y":b.contains({x:this.BBox.x,y:this.BBox.y})&&b.contains({x:this.BBox.x,y:this.BBox.y+this.BBox.height})||b.contains({x:this.BBox.x+this.BBox.width,y:this.BBox.y})&&b.contains({x:this.BBox.x+this.BBox.width,y:this.BBox.y+this.BBox.height})?"x":b.contains({x:this.BBox.x,y:this.BBox.y})||b.contains({x:this.BBox.x+this.BBox.width,y:this.BBox.y})||b.contains({x:this.BBox.x,y:this.BBox.y+this.BBox.height})||b.contains({x:this.BBox.x+this.BBox.width,y:this.BBox.y+this.BBox.height})?"y":null}},{key:"click",value:function click(){}},{key:"update",value:function update(){}},{key:"BBox",get:function get(){return null}},{key:"hovering",get:function get(){return this.contains(this.game.mousePos)}}]),a}(),Paddle=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.posx=d.game.canvas.width/2,d.speed=0,d.width=250,d.blur_start=+new Date-1e3,d}return _inherits(b,a),_createClass(b,[{key:"update",value:function update(c,d){this.speed*=0.9,this.game.pressed.ArrowLeft||this.game.pressed.a?this.speed-=d/5:(this.game.pressed.ArrowRight||this.game.pressed.d)&&(this.speed+=d/5),this.posx=Math.max(this.width/2,Math.min(this.game.canvas.width-this.width/2,this.posx+this.speed)),c.shadowColor="rgba(255,255,255,"+Math.min(1,Math.max(0,1-(+new Date-this.blur_start)/1e3))+")",c.shadowBlur=+new Date-this.blur_start,c.lineWidth=30,c.lineCap="round",c.strokeStyle="#fafafa",c.beginPath(),c.moveTo(this.posx-this.width/2+15,this.game.canvas.height-100),c.lineTo(this.posx+this.width/2-15,this.game.canvas.height-100),c.stroke(),c.shadowBlur=0}},{key:"BBox",get:function get(){return{x:this.posx-this.width/2,y:this.game.canvas.height-115,width:this.width,height:30}}}]),b}(GameObject),Ball=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.pos={x:d.game.canvas.width/2,y:d.game.canvas.height/2},d.nspeed=20,d.speed={x:5*(Math.random()-0.5),y:d.nspeed},d.trail=[],d.death_start=-1,d.bounce_sound=new Audio("bounce.wav"),d.bounce_sound.volume=0.3,d.death_sound=new Audio("death.wav"),d.death_sound.volume=0.5,d.win_sound=new Audio("win.wav"),d.win_sound.volume=0.5,d}return _inherits(b,a),_createClass(b,[{key:"click",value:function click(){this.game.end&&(game=new Game(document.getElementById("canvas"))),0<=this.game.lives&&(game.ball.nspeed=this.nspeed+7,game.score=this.game.score,game.ball.speed.y=game.ball.nspeed)}},{key:"update",value:function update(c,d){if(-1!==this.death_start){var e=+new Date-this.death_start;if(c.fillStyle="#fafafa",c.shadowBlur=50,c.beginPath(),500>e)c.arc(this.pos.x,this.pos.y,Math.pow(e/10+4,2),0,2*Math.PI);else{if(this.game.end)return this.hovering&&(document.body.style.cursor="pointer"),c.arc(this.pos.x,this.pos.y,1e4,0,2*Math.PI),c.fill(),c.globalAlpha=Math.max(Math.min((e-500)/2e3,1),0),c.textAlign="center",c.fillStyle="#212121",c.font="500px FontAwesome",0>this.game.lives?c.fillText("\uF00D",1e3,600):c.fillText("\uF091",1e3,600),c.font="200px FontAwesome",0>this.game.lives?c.fillText("\uF021",1e3,1150):c.fillText("\uF061",1e3,1150),void(c.globalAlpha=1);1e3>e?(this.pos={x:this.game.canvas.width/2,y:this.game.canvas.height/2},this.trail=[],this.game.paddle.posx=this.game.canvas.width/2,c.arc(this.pos.x,this.pos.y,Math.pow((1e3-e)/10+4,2),0,2*Math.PI)):(this.death_start=-1,this.speed={x:5*(Math.random()-0.5),y:this.nspeed})}c.fill(),c.shadowBlur=0}-1===this.death_start&&this.pos.y>this.game.canvas.height-10&&(this.death_start=+new Date,this.speed={x:0,y:0},this.game.lives--,this.death_sound.play()),10>this.pos.y&&(this.pos.y=10,this.speed.y*=-1,this.bounce_sound.play()),(10>this.pos.x||this.pos.x>this.game.canvas.width-10)&&(this.pos.x=Math.max(10,Math.min(this.game.canvas.width-10,this.pos.x)),this.speed.x*=-1,this.bounce_sound.play()),this.collides(this.game.paddle)&&(this.speed.x=0.7*this.nspeed*((this.pos.x-this.game.paddle.posx)/(this.game.paddle.width/2)),this.speed.y=-Math.sqrt(this.nspeed*this.nspeed-this.speed.x*this.speed.x),this.speed.x+=this.game.paddle.speed,this.pos.y=this.game.canvas.height-125,this.game.paddle.blur_start=+new Date,this.bounce_sound.play());var f={x:1,y:1},_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var j,h=this.game.bricks[Symbol.iterator]();!(_iteratorNormalCompletion=(j=h.next()).done);_iteratorNormalCompletion=!0){var k=j.value,l=this.collides(k);l&&(1===this.game.bricks.length&&(this.death_start=+new Date,this.speed={x:0,y:0},this.win_sound.play()),k.destroy(),"x"===l&&(f.x=-1),"y"===l&&(f.y=-1))}}catch(m){_didIteratorError=!0,_iteratorError=m}finally{try{!_iteratorNormalCompletion&&h.return&&h.return()}finally{if(_didIteratorError)throw _iteratorError}}this.speed.x*=f.x,this.speed.y*=f.y,this.pos.x+=this.speed.x*d/20,this.pos.y+=this.speed.y*d/20,this.trail.unshift(Object.assign({},this.pos)),this.trail=this.trail.splice(0,30),c.fillStyle="#fafafa",c.shadowBlur=30;for(var g=0;g<this.trail.length;g++)c.globalAlpha=(30-g)/30,c.beginPath(),c.arc(this.trail[g].x,this.trail[g].y,17*((30-g)/30),0,2*Math.PI),c.fill();c.globalAlpha=1,c.fillStyle="#fafafa",c.shadowBlur=50,c.beginPath(),c.arc(this.pos.x,this.pos.y,20,0,2*Math.PI),c.fill(),c.shadowBlur=0}},{key:"BBox",get:function get(){return this.game.end?{x:900,y:950,width:250,height:250}:{x:this.pos.x-10,y:this.pos.y-10,width:20,height:20}}}]),b}(GameObject),Brick=function(a){function b(c,d,e,f){_classCallCheck(this,b);var g=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return g.pos={x:d,y:e},g.color=f,g.destroy_start=-1,g.height=60,g.brick_sound=new Audio("brick.wav"),g.brick_sound.volume=0.4,g}return _inherits(b,a),_createClass(b,[{key:"destroy",value:function destroy(){this.game.score++,this.brick_sound.play(),this.destroy_start=+new Date,_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"destroy",this).call(this),this.game.gameObjects.push(this),this.game.bricks.splice(this.game.bricks.indexOf(this),1)}},{key:"update",value:function update(c){if(-1!==this.destroy_start){var e=+new Date-this.destroy_start;990<=e&&_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"destroy",this).call(this),c.globalAlpha=1-e/1e3,c.shadowColor=this.color,c.shadowBlur=e,this.height=60*Math.pow(1-e/1e3,7)}c.strokeStyle=this.color,c.lineWidth=Math.max(1e-3,this.height-15),c.lineCap="butt",c.beginPath(),c.moveTo(this.pos.x-95+5,this.pos.y),c.lineTo(this.pos.x+95-5,this.pos.y),c.stroke(),c.lineWidth=20*(this.height/60),c.lineCap="round",c.beginPath(),c.moveTo(this.pos.x-95+15,this.pos.y+this.height/2-10),c.lineTo(this.pos.x+95-15,this.pos.y+this.height/2-10),c.stroke(),c.beginPath(),c.moveTo(this.pos.x-95+15,this.pos.y-this.height/2+10),c.lineTo(this.pos.x+95-15,this.pos.y-this.height/2+10),c.stroke(),c.globalAlpha=1,c.shadowBlur=0}},{key:"BBox",get:function get(){return{x:this.pos.x-95,y:this.pos.y-20,width:190,height:60}}}]),b}(GameObject),Game=function(){function a(b){var c=this;_classCallCheck(this,a),this.canvas=b,this.canvas.onmousemove=function(e){c.mouseMove(e)},this.canvas.onmousedown=function(e){c.click(e)},this.pressed={},window.onkeydown=function(e){c.pressed[e.key]=!0},window.onkeyup=function(e){c.pressed[e.key]=!1},this.ctx=canvas.getContext("2d"),this.gameObjects=[],this.lastTime=+new Date,this.mousePos={x:0,y:0},this.lives=3,this.score=0,this.paddle=new Paddle(this),this.bricks=[];for(var d=0;10>d;d++)this.bricks.push(new Brick(this,195*d+120,145,"#d50000")),this.bricks.push(new Brick(this,195*d+120,220,"#aa00ff")),this.bricks.push(new Brick(this,195*d+120,295,"#2962ff")),this.bricks.push(new Brick(this,195*d+120,370,"#00bfa5")),this.bricks.push(new Brick(this,195*d+120,445,"#aeea00"));this.ball=new Ball(this),window.requestAnimationFrame(function(){c.render()})}return _createClass(a,[{key:"add",value:function add(b){this.gameObjects.push(b)}},{key:"remove",value:function remove(b){this.gameObjects.splice(this.gameObjects.indexOf(b),1)}},{key:"mouseMove",value:function mouseMove(b){var c=this.canvas.getBoundingClientRect(),d=Math.floor((b.clientX-c.left)/this.canvas.offsetWidth*this.canvas.width),e=Math.floor((b.clientY-c.top)/this.canvas.offsetHeight*this.canvas.height);this.mousePos={x:d,y:e}}},{key:"click",value:function click(b){this.mouseMove(b);var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var d,e,c=this.gameObjects[Symbol.iterator]();!(_iteratorNormalCompletion2=(d=c.next()).done);_iteratorNormalCompletion2=!0)e=d.value,e.hovering&&e.click()}catch(f){_didIteratorError2=!0,_iteratorError2=f}finally{try{!_iteratorNormalCompletion2&&c.return&&c.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}},{key:"render",value:function render(){var e=this;document.body.style.cursor="default";var b=+new Date-this.lastTime;this.lastTime=+new Date,this.ctx.fillStyle="#212121",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var g,h,f=this.gameObjects[Symbol.iterator]();!(_iteratorNormalCompletion3=(g=f.next()).done);_iteratorNormalCompletion3=!0)h=g.value,h.update(this.ctx,b)}catch(j){_didIteratorError3=!0,_iteratorError3=j}finally{try{!_iteratorNormalCompletion3&&f.return&&f.return()}finally{if(_didIteratorError3)throw _iteratorError3}}this.end||(this.ctx.fillStyle="#fafafa");for(var c=0;c<this.lives;c++)this.ctx.beginPath(),this.ctx.arc(60+60*c,60,20,0,2*Math.PI),this.ctx.fill();this.ctx.textAlign="center",this.ctx.font="45px FontAwesome";for(var d=0;d<(this.ball.nspeed-20)/7;d++)this.ctx.fillText("\uF061",this.canvas.width-60-60*d,75);this.ctx.font="45px cliche",this.ctx.fillText(this.score,this.canvas.width/2,75),window.requestAnimationFrame(function(){e.render()})}},{key:"end",get:function get(){return 0===this.bricks.length||0>this.lives}}]),a}(),game=new Game(document.getElementById("canvas"));